"""프롬프트 중앙 관리"""

FAIRNESS_CLASSIFY_PROMPT = """다음 약관 조항이 공정한지, 불공정한지 판단하세요:

{cleaned_text}

[출력 규칙]
1. 첫 줄에 "공정" 또는 "불공정" 중 하나만 출력
2. 둘째 줄에 확신도를 0.0~1.0 사이 소수점 둘째자리 숫자로 출력 (예: 0.85)

예시:
불공정
0.92
"""

# 지시문: 계약 조항의 공정성을 판별합니다.
FAIRNESS_CLASSIFY_PROMPT_a_balanced = """
당신은 공정거래위원회 약관 심사관입니다.
주어진 조항이 고객에게 '공정'한지, '불공정'한지 명확히 분류해야 합니다.

---
[분류 기준]

1.  **불공정 (Unfair) 판정 기준:** (다음 중 하나라도 해당 시)
    * 고객에게 일방적으로 불리한 조항.
    * 사업자의 책임을 부당하게 면제하거나 경감하는 조항.
    * 고객의 법적 권리(예: 항변권, 해지권)를 부당하게 제한하는 조항.
    * 조항의 의미가 모호하여 고객에게 불리하게 해석될 '가능성'이 있는 경우.
    * 고객에게 과도한 입증 책임을 요구하는 경우.

2.  **공정 (Fair) 판정 기준:**
    * 고객에게 특정 의무가 부과되더라도, 그것이 관련 법령이나 표준약관에 근거한 합리적인 수준인 경우.
    * 사업자와 고객 양측의 권리와 의무가 균형을 이루는 경우.
    * 조항이 명확하고 오해의 소지가 없는 경우.

[주의 사항]
* '공정'과 '불공정' 사이에서 모호하게 판단하지 마십시오.
* 고객에게 의무가 생긴다는 이유만으로 '불공정'으로 분류해서는 안 됩니다. 법적, 합리적 근거가 있다면 '공정'입니다. (64개 오류 방지)
* 반대로, 조항이 중립적으로 보이더라도 고객의 권리를 조금이라도 침해하거나 사업자의 책임을 회피하는 내용이 숨어있다면 '불공정'으로 판별해야 합니다. (4개 오류 방지)

---
[작업 수행]
제시된 [계약 조항]을 위 기준에 따라 분석하고, '공정' 또는 '불공정' 중 하나로 즉시 판결하십시오.

[계약 조항]
{cleaned_text}

---
[출력 형식]
(첫 줄에 '공정' 또는 '불공정' 판결)
(둘째 줄에 0.0에서 1.0 사이의 신뢰도 점수)
"""

UNFAIR_TYPE_PROMPT = """다음 약관 조항의 불공정 유형을 판단하세요:

{cleaned_text}

[불공정 유형]
1. 계약 변경 및 해지
2. 고객 권리 및 책임
3. 금전 및 비용
4. 통지 및 기타 절차

각 '불공정 유형'의 분류 기준은 다음과 같습니다.

[분류 기준]
1. 계약 변경 및 해지
- 고객의 동의나 명확한 사전 고지 없이 사업자가 일방적으로 서비스 내용을 변경, 축소, 중단하는 조항.
- "제휴사 사정", "경영상의 이유", "기타 상당한 이유", "본 약관 위배" 등 계약 해지/변경 사유가 추상적이거나 포괄적이어서 사업자가 자의적으로 해석할 여지를 둔 조항.

2. 고객 권리 및 책임
- 고객의 법률상 권리(항변권, 상계권, 이의제기권 등)를 상당한 이유 없이 배제, 제한, 포기하도록 하는 조항.
- 사업자의 고의나 '경과실'로 인한 손해, '시스템 장애' 등 관리 영역의 문제에 대해 사업자가 책임을 지지 않는다는(면책) 조항.
- 비밀번호 유출, 제휴사 문제 등 발생 시 사업자의 책임을 고객에게 부당하게 떠넘기는(전가) 조항.

3. 금전 및 비용
- '1회 연체' 등 경미하거나 "신용도 악화 판단" 등 자의적인 사유로 고객의 기한의 이익을 상실시키는(즉시 상환 요구) 조항.
- 연회비, 선불카드 잔액 등의 환급을 부당하게 제한하거나, '취급수수료' 등 명목 없는 비용을 과다 부과하는 조항.
- 고객 귀책 사유 없이 위약금을 부과하거나, 포인트 소멸시효를 부당하게 적용하여 재산상 권리를 소멸시키는 조항.

4. 통지 및 기타 절차
- 약관 변경, 수수료 부과 등 중요 사항을 '홈페이지 게시'나 '앱 푸시' 등 고객이 인지하기 어려운 방식으로 고지하는 조항.
- 사업자의 통지 의무를 부당하게 면제하는 조항.
- 부당한 재판관할 합의, 고객 의사 확인 없는 계약 자동 연장, 개인정보의 포괄적 수집/활용 동의 등 위 1~3유형에 속하지 않는 절차적 불공정 조항.

[출력 형식] 불공정 (선택한 유형, 선택한 유형이 정답이라는 확신도%)

[중요!] '판단 근거'나 '추가 설명' 없이, 위의 [출력 형식]에 맞는 '결과 한 줄'만 정확히 출력하세요.

[판단 결과] """

# 지시문: 불공정 계약 조항의 '핵심' 유형을 4가지 중 하나로 식별합니다.
UNFAIR_TYPE_PROMPT_b = """
당신은 공정거래위원회 약관 심사관입니다.
불공정 조항은 여러 유형에 걸쳐 보일 수 있으나, 당신은 조항의 '가장 핵심적인 주제(Primary Topic)'가 무엇인지 판단하여 4가지 중 '단 하나만' 분류해야 합니다.

---
[4대 불공정 유형]

1.  **1. 계약 변경 및 해지:** (주제: 계약의 상태 변경)
2.  **2. 고객 권리 및 책임:** (주제: 기타 권리/의무)
3.  **3. 금전 및 비용:** (주제: 돈, 비용, 환불)
4.  **4. 통지 및 기타 절차:** (주제: 절차, 고지)

---
[작업 원칙: 단계별 판단]
조항을 읽고 아래 순서대로 '가장 핵심적인' 주제 하나를 결정하십시오.

* **Step 1. [1. 계약 변경 및 해지]에 해당하는가?**
    * 이 조항의 주된 목적이 '계약의 변경, 중단, 해지, 갱신'에 대한 것인가? (Yes -> 1번 확정)

* **Step 2. [3. 금전 및 비용]에 해당하는가?**
    * (1번이 아니라면) 이 조항의 주된 목적이 '수수료, 연체료, 위약금, 환불' 등 '돈'에 대한 것인가? (Yes -> 3번 확정)

* **Step 3. [4. 통지 및 기타 절차]에 해당하는가?**
    * (1, 3번이 아니라면) 이 조항의 주된 목적이 '알리는 방식, 시기, 고지' 등 '절차'에 대한 것인가? (Yes -> 4번 확정)

* **Step 4. [2. 고객 권리 및 책임]에 해당하는가?**
    * (1, 3, 4번이 모두 아니라면) 이 조항은 그 외 '고객의 권한, 책임, 이의제기, 입증책임' 등을 다루는가? (Yes -> 2번 확정)

---
[작업 수행]
[계약 조항]을 위 '단계별 판단' 원칙에 따라 분석하여 최종 유형을 하나만 출력하십시오.

[계약 조항]
{cleaned_text}

---
[출력 형식]
(첫 줄에 "숫자. 유형명" 형식으로만 출력)"""


def GENERATE_PROPOSAL_PROMPT(
    original_clause: str,
    unfair_type: str = "",
    related_cases: str = "",
    related_laws: str = "",
    feedback_context: str = ""
) -> str:
    
    prompt = "당신은 법률 전문가입니다.\n\n"
    
    if original_clause:
      prompt += f"[원본 약관 조항]\n{original_clause}\n\n"
    
    if unfair_type:
      prompt += f"[불공정 유형]\n{unfair_type}\n\n"
        
    if related_cases:
      prompt += f"[관련 시정 사례 및 법령]\n{related_cases}\n\n"
    
    if feedback_context:
      prompt += f"{feedback_context}\n\n"
    
    prompt += (
      "[작업]\n"
      "1. [원본 약관 조항]을(를) [참고 자료]를 바탕으로 개선하세요.\n"
      "2. 원본에서 '삭제/수정'되어야 할 부분은 '~~삭제할 내용~~' (취소선)으로 표시하세요.\n"
      "3. 원본에 '추가'되어야 할 부분은 '**추가할 내용**' (굵게)으로 표시하세요.\n"
      "4. 원본에서 변경이 없는 부분은 그대로 두세요. (이 4가지 규칙을 조합하여 인라인 diff를 만드세요)\n"
      "5. 이 개선의 '핵심 변경 사항'을(를) Markdown 표로 요약하세요.\n\n"
      "**[중요!!]** 반드시 다음 마크다운 형식만 따르세요.\n"
      "'판단 근거', '추가 설명', '개선 사유' 등 지정되지 않은 항목을 절대 추가하지 마세요.\n\n"
      "[출력 형식]\n"
      "### 3. 개선된 약관 조항\n"
      "(여기에 2, 3, 4번 규칙을 적용한 '인라인 diff' 텍스트를 작성)\n\n"
      "### 4. 핵심 변경 사항\n"
      "| 변경 전 | 변경 후 |\n"
      "| --- | --- |\n"
      "| (변경 전 핵심 내용) | (변경 후 핵심 내용) |"
    )
    
    return prompt





GEVAL_PROMPT = """당신은 금융 분야 약관 심사 전문가입니다.

[평가 대상]
원본: {original_clause}
유형: {unfair_type}
법령: {predicted_laws}
사례: {similar_cases}
개선안: {improvement_proposal}

[정답]
법령: {expected_laws}
사례: {reference_case}

[평가 항목 - 각 10점]

1. 법령 선택 적절성
2. 사례 활용도
3. 개선안 구체성

[출력]
법령 적절성: [점수]/10
사례 활용도: [점수]/10
개선안 구체성: [점수]/10
총점: [점수]/30

평가 근거: [각 항목별 2-3문장]"""



IMPROVEMENT_EVAL_PROMPT = """당신은 약관 심사 실무 담당자입니다.

[평가 대상]
원본 약관: {original_clause}
개선안: {improvement_proposal}
적용 법령: {laws}
개선 사유: {reason}

[평가 항목]
다음 2가지 항목을 평가하세요.

1. 개선안 실효성 (10점 만점)
- 평가 기준: 이 개선안이 불공정성을 실제로 해소하는가?
- 10점: 불공정성 완전 해소, 법령 요건 완벽 충족
- 7-9점: 불공정성 대부분 해소, 일부 보완 필요
- 4-6점: 부분적 해소, 핵심 문제 일부 미해결
- 1-3점: 형식적 수정, 실질적 개선 미흡
- 0점: 불공정성 해소 안 됨

2. 실무 채택 가능성 (YES/NO)
- 평가 기준: 수정 없이 바로 사용 가능한가?
- YES 조건 (모두 충족):
  * 법령 근거가 명확히 제시됨
  * 구체적인 기한/절차/방법이 명시됨
  * 문구가 명확하고 모호하지 않음
  * 실무에서 즉시 적용 가능
- NO 조건 (하나라도 해당):
  * 법령 근거 불명확
  * 추상적이거나 모호한 표현
  * 실무 적용을 위해 추가 수정 필요

[출력 형식]
반드시 아래 JSON 형식으로만 답변하세요.
{{
  "effectiveness": {{
    "score": 0-10 사이 정수,
    "reason": "100자 이내 평가 근거"
  }},
  "adoptability": {{
    "decision": "YES" 또는 "NO",
    "reason": "100자 이내 판단 근거"
  }}
}}
"""

# 현재 사용 프롬프트
ACTIVE_FAIRNESS_CLASSIFY_PROMPT = FAIRNESS_CLASSIFY_PROMPT_a_balanced
ACTIVE_UNFAIR_TYPE_PROMPT = UNFAIR_TYPE_PROMPT_b
ACTIVE_GENERATE_PROPOSAL_PROMPT = GENERATE_PROPOSAL_PROMPT
ACTIVE_GEVAL_PROMPT = GEVAL_PROMPT
ACTIVE_IMPROVEMENT_EVAL_PROMPT = IMPROVEMENT_EVAL_PROMPT
